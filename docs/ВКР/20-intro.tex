\myChapter{1 АНАЛИТИЧЕСКИЙ ОБЗОР ЛИТЕРАТУРЫ}
\label{cha:analysis}

В данной работе будут анализироваться только 3 задачи поиска по геоданным. Пусть дано множество точек, представляющих собой пару широта-долгота, отображающих некий объект на поверхности земли, например, самокат, пользователя, дом. 

Необходимо произвести операции:
\par а) BBox(bottomLeft Point, upperRight Point) Points - поиск всех объектов, которые находятся внутри прямоугольника, определяемого нижним левым углом (bottomLeft) и правым верхним углом (upperRight). Возвращается массив найденных точек;
\par б) KNN(p Point, k int) Points - поиск k ближайших объектов от точки p. Возвращается массив найденных точек;
\par в) Insert(p Point) - вставка нового элемента (точки) в индекс. 

Важно отметить, что зачастую для прикладных задач также требуется решить задачу поиска в круге: найти все точки X, находящиеся на заданном расстоянии R от точки Y. Эта задача не рассматривается в данной работе из-за того, что на части индексов она не может быть решена оптимально. Например, в дереве R-tree. При этом её все равно можно решить через задачу BBox: 
\par а) решить задачу BBox для квадрата, описывающего заданный круг;
\par б) простым перебором отсечь точки, которые не входят в заданный круг.

Задача BBox может быть также сведена к задаче поиска в круге:
\par а) решить задачу поиска в круге для круга, описывающего прямоугольник;
\par б) простым перебором отсечь точки, которые не входят в заданный прямоугольник.

\section{1.1 Расстояние между двумя точками}
Указанные выше задачи требуют определить понятие расстояния между двумя точками на сфере земли. Для этого введем понятие геоточки --- это точка, представляющая собой кортеж A(x, y), где x и y - широта и долгота соответственно. 
Расстояние между двумя точками есть наименьшая прямая на плоскости земного шара, при этом ее вычисление может быть разным в зависимости от рассматриваемой задачи. \\
Определим задачу. Даны геоточки $A(x_1, y_1), B(x_2, y_2)$. Требуется найти расстояние $d(A, B)$.

\subsection{1.1.1 Евклидово расстояние}
В некоторых системах, например, в расширении Postgis для СУБД Postgres для типа Geometry, используется евклидово расстояние.
  \newline
\begin{equation} \label{eq}
\
\ d(A, B)=sqrt((x_1-x_2)^2+(y_1-y_2)^2).
\
\end{equation}
  \newline
Такой подход работает корректно только в части случаев, так, например, он выдаст правильный результат с точностью до 5 метров в случае поиска расстояния в пределах Москвы, но расстояние в Африке будет отличаться в 2-3 раза относительно более строгих подходов.  
При этом важно отметить, что данная дистанция отвечает аксиомам метрики, поэтому ее корректно использовать при сравнении расстояний между двумя точками, например, при решении задачи KNN (К-ближайших соседей). 

\subsection{1.1.2 Расстояние гаверсинуса}

Расстояние гаверсинуса — это способ определения расстояния между двумя точками на поверхности Земли, учитывающий её кривизну. Он используется в геопоиске для определения расстояния между заданной точкой и объектами в заданном радиусе.

Формула расстояния гаверсинуса выглядит следующим образом.
    \newline
\begin{equation}\label{eq}
    \begin{aligned}
        d(A, B) = \\
        = 2R \arcsin\left(sqrt(\frac{1 - \cos\left(\Delta x \right) + \cos x_1 \cdot \cos x_2 \cdot \left(1 - \cos\left(\Delta y\right)\right)}{2})\right),
    \end{aligned}
\end{equation}
\par\vspace{1em}
\par\vspace{1em}
\noindent
где d - расстояние между двумя точками в километрах, R - радиус Земли (приблизительно 6371 км), $x_1$ и $x_2$ - широты двух точек в радианах, $y_1$ и $y_2$ - долготы двух точек в радианах.

Эта формула позволяет определить расстояние между точками с точностью до нескольких метров, что делает ее очень полезной для геопоиска. Однако она может быть достаточно ресурсоёмкой при работе с большими объемами геоданных, что делает ее медленнее по сравнению с Евклидовым расстоянием. 

\subsection{1.1.3 Геодезическое расстояние}
Геодезическое расстояние — это расстояние между двумя точками на поверхности Земли, измеренное вдоль кратчайшей линии (геодезической линии) между этими точками. Геодезическая линия — это кривая на поверхности Земли, которая имеет наименьшую длину между двумя точками.

Геодезическое расстояние учитывает кривизну Земли и может отличаться от расстояния гаверсинуса, особенно на больших расстояниях и при использовании разных моделей формы Земли.

Формула вычисления геодезии.
\begin{equation} \label{eq}
\ d(A, B) = R \cdot \arccos(\sin(x_1) \cdot \sin(x_1) + \cos(x_1) \cdot \cos(x_2) \cdot \cos(y_2 - y_1).
\end{equation}
\par
Таким образом, при выборе формулы поиска расстояния надо учитывать требования. Например, при разработке приложения кикшеринга, то есть аренды электронных самокатов, формулы можно комбинировать. На запросах, которые возвращают клиентам ближайшие самокаты от их текущей геопозиции по радиусу можно использовать метрику Евклида, так как ошибку даже на 20-30 метров можно нивелировать поиском по большему радиусу.  
При этом, в ситуации, когда требуется построить аналитику данных, лучше использовать расстояние геодезии, потому что в данных задачах крайне важна точность результата, а разница в скорости решения не так принципиальна. 
